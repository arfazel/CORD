
tosca_definitions_version: tosca_simple_yaml_1_0

imports:
  - custom_types/addresspool.yaml
  - custom_types/addressmanagerservice.yaml
  - custom_types/addressmanagerserviceinstance.yaml
  - custom_types/network.yaml
  - custom_types/networktemplate.yaml
  - custom_types/serviceinstance.yaml
  - custom_types/serviceinstancelink.yaml
  - custom_types/site.yaml
  - custom_types/slice.yaml

description: public network config, generated by rcord profile

topology_template:
  node_templates:

# site, fully created in deployment.yaml.j2
    mysite:
      type: tosca.nodes.Site
      properties:
        name: mysite
        must-exist: true

    mysite_public:
      description: This slice exists solely to own the public network
      type: tosca.nodes.Slice
      properties:
        network: noauto
        name: mysite_public
      requirements:
        - site:
            node: mysite
            relationship: tosca.relationships.BelongsToOne

# Address Manager service, fully created in cord-services.yaml.j2
    service#addressmanager:
      type: tosca.nodes.AddressManagerService
      properties:
        name: addressmanager
        must-exist: true

# public network
    public_template:
      type: tosca.nodes.NetworkTemplate
      properties:
        name: public_template
        visibility: public
        translation: none
        vtn_kind: PUBLIC

    public:
      type: tosca.nodes.Network
      properties:
        name: public
        permit_all_slices: true
        subnet: 10.8.1.0/24
        # ip_version: 4
      requirements:
        - template:
            node: public_template
            relationship: tosca.relationships.BelongsToOne
        - owner:
            node: mysite_public
            relationship: tosca.relationships.BelongsToOne

# Created in cord-services.yaml.j2
    addresses_public:
      type: tosca.nodes.AddressPool
      properties:
        name: addresses_public
        must-exist: true

    AddressManagerServiceInstancePublicNetwork:
      type: tosca.nodes.AddressManagerServiceInstance
      requirements:
        - owner:
            node: service#addressmanager
            relationship: tosca.relationships.BelongsToOne
        - address_pool:
            node: addresses_public
            relationship: tosca.relationships.BelongsToOne
      properties:
        name: AM_public_net

    public_to_address_manager:
      type: tosca.nodes.ServiceInstanceLink
      requirements:
        - provider_service_instance:
            node: AddressManagerServiceInstancePublicNetwork
            relationship: tosca.relationships.BelongsToOne
        - subscriber_network:
            node: public
            relationship: tosca.relationships.BelongsToOne

